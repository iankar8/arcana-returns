---
title: 'Authentication'
description: 'How to authenticate with the Arcana Returns API'
---

## API Keys

All API requests (except webhooks and health checks) require an API key in the `Authorization` header with Bearer scheme.

```http
Authorization: Bearer sk_live_your_api_key_here
```

## Key Types

| Prefix | Environment | Usage |
|--------|-------------|-------|
| `sk_test_` | Test | Development and testing |
| `sk_live_` | Production | Live transactions |

<Warning>
  Never commit API keys to version control or expose them client-side!
</Warning>

## Creating API Keys

<Tabs>
  <Tab title="Dashboard">
    1. Log in to [dashboard.arcana.returns](https://arcana.returns/dashboard)
    2. Navigate to **Settings** → **API Keys**
    3. Click **Create New Key**
    4. Name your key and select environment
    5. Copy the key (shown only once!)
  </Tab>
  
  <Tab title="CLI">
    ```bash
    # Install CLI
    npm install -g arcana-cli
    
    # Create key
    arcana keys create --merchant merchant_id --name "Production Key"
    ```
  </Tab>
</Tabs>

## Security Best Practices

<AccordionGroup>
  <Accordion title="Store Keys Securely">
    - Use environment variables, never hardcode
    - Use secret management tools (AWS Secrets Manager, 1Password, etc.)
    - Rotate keys every 90 days
  </Accordion>
  
  <Accordion title="Use Different Keys">
    - Separate keys for dev, staging, production
    - Different keys for different services
    - Easier to track usage and revoke if compromised
  </Accordion>
  
  <Accordion title="Monitor Usage">
    - Check API key usage in dashboard
    - Set up alerts for unusual activity
    - Review `last_used_at` timestamps
  </Accordion>
  
  <Accordion title="Revoke Compromised Keys">
    - Immediately revoke if exposed
    - Generate new key before revoking old one
    - Update all services using the old key
  </Accordion>
</AccordionGroup>

## Environment Variables

<CodeGroup>

```bash .env
# Production
ARCANA_API_KEY=sk_live_abc123...
ARCANA_BASE_URL=https://arcana-returns-api.fly.dev

# Test
ARCANA_API_KEY=sk_test_xyz789...
ARCANA_BASE_URL=https://arcana-returns-api.fly.dev
```

```javascript Node.js
// Load from environment
const apiKey = process.env.ARCANA_API_KEY;
const baseUrl = process.env.ARCANA_BASE_URL || 'https://arcana-returns-api.fly.dev';

// Use in requests
const headers = {
  'Authorization': `Bearer ${apiKey}`,
  'Content-Type': 'application/json'
};
```

```python Python
import os

# Load from environment
api_key = os.environ['ARCANA_API_KEY']
base_url = os.environ.get('ARCANA_BASE_URL', 'https://arcana-returns-api.fly.dev')

# Use in requests
headers = {
    'Authorization': f'Bearer {api_key}',
    'Content-Type': 'application/json'
}
```

</CodeGroup>

## Error Responses

All errors use the enhanced format with actionable suggestions:

```json
{
  "error": {
    "code": "AUTH-001",
    "message": "Missing or invalid API key",
    "suggestion": "Check that your Authorization header is set correctly: \"Bearer sk_...\"",
    "docs_url": "https://docs.arcana.dev/errors/AUTH-001",
    "trace_id": "trc_abc123"
  }
}
```

### Common Authentication Errors

| Error Code | Status | Description | Resolution |
|------------|--------|-------------|------------|
| `AUTH-001` | 401 | Invalid API key | Check key format and validity |
| `AUTH-002` | 403 | Unauthorized | Key doesn't have permission for this resource |
| `RATE-001` | 429 | Rate limit exceeded | Wait for `Retry-After` seconds, implement exponential backoff |

<Note>
  All error responses include a `trace_id` for debugging. Include this when contacting support.
</Note>

## Rate Limits

Rate limits are **per-endpoint** and **per-merchant** to ensure fair resource allocation:

| Endpoint | Limit | Window |
|----------|-------|--------|
| `/returns/token` | 100 req/min | 60 seconds |
| `/returns/authorize` | 50 req/min | 60 seconds |
| `/returns/commit` | 50 req/min | 60 seconds |
| `/webhooks/shopify` | 200 req/min | 60 seconds |
| `/webhooks/stripe` | 200 req/min | 60 seconds |
| Other endpoints | 1000 req/min | 60 seconds |

Rate limit info is returned in headers:

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 45
X-RateLimit-Window: 60
Retry-After: 45
```

<Tip>
  Limits are per-merchant, so different API keys have separate quotas.
</Tip>

## Testing Authentication

<CodeGroup>

```javascript Node.js
const response = await fetch('https://arcana-returns-api.fly.dev/health', {
  headers: {
    'Authorization': `Bearer ${process.env.ARCANA_API_KEY}`
  }
});

if (response.ok) {
  console.log('✅ Authentication successful!');
} else {
  console.error('❌ Authentication failed:', await response.json());
}
```

```bash cURL
curl https://arcana-returns-api.fly.dev/health \
  -H "Authorization: Bearer sk_test_..." \
  -v

# Look for HTTP 200 OK
```

</CodeGroup>

## Webhook Authentication

Webhooks use HMAC signatures instead of API keys. See the [Webhooks documentation](/api-reference/webhooks/shopify) for details.

## Next Steps

<CardGroup>
  <Card title="Quickstart" icon="rocket" href="/quickstart">
    Make your first authenticated API call
  </Card>
  <Card title="Security Best Practices" icon="shield" href="/guides/security">
    Learn more about securing your integration
  </Card>
</CardGroup>
